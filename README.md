# mcp_test

---

# æ–‡ä»¶æ¶æ§‹

æœ¬æ–‡ä»¶èªªæ˜ MCP å¤š agent ç³»çµ±çš„ DDD åˆ†å±¤ã€å°è©±æµç¨‹ã€API è¨­è¨ˆã€agent è¨»å†Šã€ç¶­è­·å»ºè­°èˆ‡å¸¸è¦‹å•é¡Œï¼Œä¸¦åŒæ­¥è¨˜éŒ„æ¯æ¬¡ refactor çš„é‡é»èˆ‡ changelogã€‚

ä¸»è¦å…§å®¹åˆ†ç‚ºï¼š
- æ¶æ§‹åˆ†å±¤èˆ‡è¨­è¨ˆåŸå‰‡
- å°è©±æµç¨‹èˆ‡ API è·¯å¾‘
- Agent è¨»å†Šèˆ‡è‡ªå‹•åˆä½µ
- å‰å¾Œç«¯ schema èˆ‡å›å‚³æ ¼å¼
- æ¸¬è©¦èˆ‡ç¶­è­·å»ºè­°
- Changelog è¿½è¹¤æ¯æ¬¡é‡å¤§èª¿æ•´

# MCP æ¶æ§‹èªªæ˜æ–‡ä»¶

## 2025/5/8 DDD é‡æ§‹é‡é»

- æ¡ç”¨ DDDï¼ˆDomain-Driven Designï¼‰åˆ†å±¤ï¼šæ˜ç¢ºå€åˆ† toolsã€agentsã€orchestrator ä¸‰å±¤ã€‚
- tools/ï¼šæœ€åº•å±¤åŠŸèƒ½å–®å…ƒï¼Œç„¡ç‹€æ…‹ã€ç„¡æ±ºç­–ï¼Œåƒ…è² è²¬ã€Œåšäº‹ã€ã€‚
- agents/ï¼šæœ‰é‚è¼¯ã€æœ‰ç‹€æ…‹çš„æ™ºèƒ½ä»£ç†ï¼Œæœƒèª¿ç”¨ä¸€å€‹æˆ–å¤šå€‹ toolï¼Œä¸¦å¯å°è©±ã€æ¨ç†ã€‚
- orchestrator.pyï¼šè² è²¬æ ¹æ“šç”¨æˆ¶éœ€æ±‚ã€ä¸Šä¸‹æ–‡ï¼Œèª¿åº¦ agentï¼Œç®¡ç†å¤šæ­¥æ¨ç†ã€‚
- API è·¯å¾‘ã€å‘½åã€æ¸¬è©¦ã€æ–‡ä»¶çš†èˆ‡åˆ†å±¤ä¸€è‡´ï¼Œæ˜“æ–¼ç¶­è­·èˆ‡æ“´å……ã€‚
- æœªä¾†å¦‚éœ€æ›´è¤‡é›œèª¿åº¦ï¼Œå¯å†ç´°åˆ† tool_orchestratorã€agent_orchestrator ç­‰ã€‚

## ç›®éŒ„
- [å°ˆæ¡ˆç›®æ¨™](#å°ˆæ¡ˆç›®æ¨™)
- [ç³»çµ±åˆ†å±¤æ¶æ§‹](#ç³»çµ±åˆ†å±¤æ¶æ§‹)
- [Agent è¨»å†Šèˆ‡åˆä½µæµç¨‹](#agent-è¨»å†Šèˆ‡åˆä½µæµç¨‹)
- [API Response Schema](#api-response-schema)
- [è¨­è¨ˆåŸå‰‡](#è¨­è¨ˆåŸå‰‡)
- [ç¶­è­·å»ºè­°èˆ‡ FAQ](#ç¶­è­·å»ºè­°èˆ‡-faq)
- [ç›¸é—œæª”æ¡ˆèªªæ˜](#ç›¸é—œæª”æ¡ˆèªªæ˜)
- [é€²åº¦è¿½è¹¤](#é€²åº¦è¿½è¹¤)
- [æ¸¬è©¦èªªæ˜](#æ¸¬è©¦èªªæ˜)

---

## å°ˆæ¡ˆç›®æ¨™

- å·²è½å¯¦ DDD åˆ†å±¤ï¼ˆtools/agents/orchestratorï¼‰ï¼Œåˆ†å±¤æ˜ç¢ºã€æ˜“æ–¼ç¶­è­·èˆ‡æ“´å……
- å‰å¾Œç«¯çš†ä»¥çµ±ä¸€ schema æºé€šï¼ŒAPI è·¯å¾‘èªæ„åŒ–ï¼Œè³‡æ–™æµæ¸…æ™°
- æ”¯æ´å¤š agent è¨»å†Šï¼ˆYAML + Python é›™è»Œï¼‰ï¼Œè‡ªå‹•åˆä½µï¼Œæ˜“æ–¼æ“´å……
- å‰ç«¯å®Œæ•´ç¶­è­· historyï¼Œæ”¯æ´å¤šè¼ªå°è©±ã€history answerã€æ„åœ–åˆ¤æ–·
- API/agent response schema æ¨™æº–åŒ–ï¼Œå‰ç«¯è‡ªå‹•æ¸²æŸ“ã€æ”¶åˆ JSON
- æ¸¬è©¦è¦†è“‹ agent è¨»å†Šã€åˆä½µã€respond æ ¼å¼èˆ‡ API schema
- UX ä½³ï¼Œæ„åœ–åˆ¤æ–·ã€æ­·ç¨‹æ‘˜è¦ã€éŒ¯èª¤è™•ç†çš†æœ‰æ˜ç¢ºé¡¯ç¤º

---

## ç³»çµ±åˆ†å±¤æ¶æ§‹

1. **tools/**
   - å–®ä¸€åŠŸèƒ½ã€ç„¡ç‹€æ…‹çš„åº•å±¤å·¥å…·ï¼ˆå¦‚æŸ¥è©¢ APIã€è¨ˆç®—ç­‰ï¼‰
   - åªåšä¸€ä»¶äº‹ï¼Œç„¡æ±ºç­–ã€ç„¡ç‹€æ…‹ï¼Œç´” function
2. **agents/**
   - æœ‰é‚è¼¯ã€æœ‰ç‹€æ…‹çš„æ™ºèƒ½ä»£ç†ï¼Œæœƒèª¿ç”¨ä¸€å€‹æˆ–å¤šå€‹ toolï¼Œä¸¦å¯å°è©±ã€æ¨ç†
   - å°è£æ±ºç­–ã€ç‹€æ…‹ã€å°è©±ç­‰è¡Œç‚º
3. **orchestrator.py**
   - è² è²¬æ ¹æ“š user queryï¼Œé¸æ“‡æ­£ç¢ºçš„ agentï¼Œèª¿ç”¨ agent çš„ respond æ–¹æ³•ï¼Œçµ„åˆå›æ‡‰
   - ç®¡ç†å¤šæ­¥æ¨ç†æµç¨‹

### æ™ºæ…§ Smart Chat å°è©±æµç¨‹èˆ‡æ¶æ§‹åœ–ï¼ˆ2025/5 DDD åˆ†å±¤é‡æ§‹å¾Œï¼‰

#### ã€history/intention å°è©±æµç¨‹èªªæ˜ã€‘
- å‰ç«¯ç¶­è­·å®Œæ•´ historyï¼Œuser/assistant/tool æ­·ç¨‹çš† push é€² messagesã€‚
- æ¯æ¬¡ç”¨æˆ¶è¼¸å…¥æ™‚ï¼Œå‰ç«¯å°‡ history çµ„æˆ promptï¼Œå‘¼å« `/analyze_intent` å–å¾—æ„åœ–ï¼ˆintent: chatã€tool_callã€history_answerï¼‰ã€‚
- å‰ç«¯æ ¹æ“š intent åˆ†æµï¼š
  - chat â†’ å‘¼å« `/chat`ï¼ŒLLM ç›´æ¥å›è¦†ã€‚
  - tool_call â†’ å‘¼å« `/agent/single_turn_dispatch`ï¼Œé€²å…¥ agent èª¿åº¦èˆ‡å¤šæ­¥æ¨ç†ï¼ˆå¦‚éœ€å†é€² `/agent/multi_turn_step`ï¼‰ã€‚
  - history_answer â†’ å‘¼å« `/history_answer`ï¼ŒLLM æ ¹æ“š history æ‰¾æœ€ä½³ç­”æ¡ˆèˆ‡ç†ç”±ã€‚
- å¤šè¼ªæ¨ç†æ™‚ï¼Œå‰ç«¯å°‡æ¯ä¸€è¼ª tool æ­·ç¨‹ push é€² historyï¼Œä¸¦æ–¼æ¯æ¬¡ step æ™‚å¸¶å…¥å®Œæ•´ historyï¼Œç¢ºä¿ LLM èƒ½æ ¹æ“šä¸Šä¸‹æ–‡åšæœ€ä½³æ±ºç­–ã€‚
- æ‰€æœ‰ API å›å‚³çš†ç”¨çµ±ä¸€ schemaï¼Œå‰ç«¯è‡ªå‹•æ¸²æŸ“ã€æ”¶åˆ JSONï¼Œé¡¯ç¤ºå¡ç‰‡ã€æ‘˜è¦ã€éŒ¯èª¤è¨Šæ¯ç­‰ã€‚

#### ã€å°è©±æµç¨‹èªªæ˜ã€‘
1. **ç”¨æˆ¶è¼¸å…¥**ï¼š
   - å‰ç«¯ï¼ˆindex.html + base.jsï¼‰ç¶­è­·å®Œæ•´ historyï¼Œå°‡ç”¨æˆ¶è¼¸å…¥ push åˆ°è¨Šæ¯å€ã€‚
2. **æ„åœ–åˆ¤æ–·**ï¼š
   - å‰ç«¯å‘¼å« `/analyze_intent`ï¼Œå–å¾— intentï¼ˆchatã€tool_call...ï¼‰èˆ‡ reasonã€‚
   - å‰ç«¯é¡¯ç¤ºæ„åœ– label èˆ‡ç´°ç¯€ï¼ˆå¯æ”¶åˆï¼‰ã€‚
3. **API åˆ†æµ**ï¼š
   - è‹¥ intent = chatï¼Œå‰ç«¯å‘¼å« `/chat`ï¼Œç”± LLM å›è¦†ã€‚
   - è‹¥ intent = tool_callï¼Œå‰ç«¯å‘¼å« `/agent/single_turn_dispatch`ï¼Œé€²å…¥ agent èª¿åº¦èˆ‡å¤šæ­¥æ¨ç†ï¼ˆå¦‚éœ€å†é€² `/agent/multi_turn_step`ï¼‰ã€‚
   - å…¶ä»– intent å‰‡é¡¯ç¤ºéŒ¯èª¤æˆ– fallbackã€‚
4. **Orchestrator èª¿åº¦**ï¼š
   - orchestrator.py åª import agentï¼Œä¸ç›´æ¥ç¢° toolï¼Œçµ±ä¸€èª¿ç”¨ agent çš„ respond æ–¹æ³•ã€‚
   - å–®æ­¥æŸ¥è©¢ï¼šdispatch_agent_single_turnã€‚
   - å¤šæ­¥æ¨ç†ï¼šdispatch_agent_multi_turn_stepï¼Œæ ¹æ“š history èˆ‡ query æ±ºå®šä¸‹ä¸€æ­¥ã€‚
5. **Agent å°è£**ï¼š
   - agents/ ç›®éŒ„ä¸‹æ¯å€‹ agent class å°è£ä¸€å€‹æˆ–å¤šå€‹ toolï¼Œè² è²¬é‚è¼¯ã€ç‹€æ…‹ã€æ¨ç†ã€‚
6. **Tool åŸ·è¡Œ**ï¼š
   - tools/ åªå­˜æ”¾ç´”åŠŸèƒ½ functionï¼Œç„¡ç‹€æ…‹ã€ç„¡æ±ºç­–ã€‚
7. **å›å‚³èˆ‡é¡¯ç¤º**ï¼š
   - å›å‚³å…§å®¹çš†ç¬¦åˆçµ±ä¸€ schemaï¼Œå‰ç«¯è‡ªå‹•æ¸²æŸ“ã€æ”¶åˆ JSONï¼Œé¡¯ç¤ºå¡ç‰‡ã€æ‘˜è¦ã€éŒ¯èª¤è¨Šæ¯ç­‰ã€‚

---

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯ UI   â”‚
â”‚ (index.html)â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  base.js                     â”‚
â”‚  1. ç¶­è­· history (messages)   â”‚
â”‚  2. ç”¨æˆ¶è¼¸å…¥ push åˆ° history  â”‚
â”‚  3. å‘¼å« /analyze_intent      â”‚
â”‚  4. é¡¯ç¤ºæ„åœ– label/ç´°ç¯€       â”‚
â”‚  5. æ ¹æ“š intent åˆ†æµï¼š         â”‚
â”‚     â”œâ”€ chat â†’ /chat           â”‚
â”‚     â”œâ”€ tool_call â†’ /agent/single_turn_dispatch
â”‚     â”œâ”€ history_answer â†’ /history_answer
â”‚     â””â”€ fallback â†’ é¡¯ç¤ºéŒ¯èª¤     â”‚
â”‚         ï¼ˆtool_call å¦‚éœ€å¤šæ­¥æ¨ç†å†é€² /agent/multi_turn_stepï¼‰â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  server.py                                                 â”‚
â”‚  1. /analyze_intentï¼šæ„åœ–åˆ¤æ–·ï¼Œå›å‚³ intent èˆ‡ reason      â”‚
â”‚  2. /chatï¼šç´” LLM chat å›è¦†                                â”‚
â”‚  3. /agent/single_turn_dispatchï¼šå–®æ­¥ agent èª¿åº¦           â”‚
â”‚  4. /agent/multi_turn_stepï¼šå¤šæ­¥æ¨ç†/å¤š agent å”ä½œ         â”‚
â”‚  5. /history_answerï¼šæ ¹æ“š history å›ç­”                     â”‚
â”‚  6. fallbackï¼šå›å‚³éŒ¯èª¤è¨Šæ¯                                 â”‚
â”‚  7. å„ API è²¬ä»»å–®ä¸€ï¼Œåˆ†å±¤æ˜ç¢º                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  orchestrator.py                             â”‚
â”‚  1. åª import agentï¼Œä¸ç›´æ¥ç¢° tool           â”‚
â”‚  2. dispatch_agent_single_turn               â”‚
â”‚  3. dispatch_agent_multi_turn_step           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  agents/                     â”‚
â”‚  1. æ¯å€‹ agent å°è£ä¸€å€‹æˆ–å¤šå€‹ tool         â”‚
â”‚  2. agent class çµ±ä¸€ respond æ–¹æ³•           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  tools/      â”‚
â”‚  ç´”åŠŸèƒ½ functionâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Agent è¨»å†Šèˆ‡åˆä½µæµç¨‹

### é›™è»Œè¨»å†Šè¨­è¨ˆ

- **YAML è¨»å†Š**ï¼ˆfor éå·¥ç¨‹å¸«ï¼‰
  - ç·¨è¼¯ `mcp_config.yaml` å…§çš„ `agents` å€å¡Š
  - é©åˆé‚è¼¯ç°¡å–®ã€æ ¼å¼å›ºå®šçš„ agent
  - ç¯„ä¾‹ï¼š
    ```yaml
    agents:
      - id: agent_a
        name: A Agent
        description: æŸ¥è©¢ç¶²è·¯æ‘˜è¦ã€å½±ç‰‡å‰ªè¼¯æ•™å­¸ç­‰
        example_queries:
          - è«‹å¹«æˆ‘æŸ¥ä¸€ä¸‹å½±ç‰‡å‰ªè¼¯æ•™å­¸
        respond: src.agent_registry.AgentA().respond
    ```

  - **routes å€å¡Š**
    - `routes` ç”¨æ–¼å®šç¾©å¤š agent èª¿åº¦çš„é è¨­æµç¨‹ï¼ˆå¦‚ pipelineï¼‰ï¼Œå¯æŒ‡å®šå¤šå€‹ agent ä¾åºè™•ç†åŒä¸€ queryã€‚
    - æ¯å€‹ route å¯åŒ…å«å¤šå€‹ stepï¼Œæ¯å€‹ step æŒ‡å®š agent åŠå…¶è¼¸å…¥æ ¼å¼ã€‚
    - ç¯„ä¾‹ï¼š
      ```yaml
      routes:
        default:
          steps:
            - agent: agent_a
              input: "{{query}}"
            - agent: agent_b
              input: "{{query}}"
            - agent: junyi_tree_agent
              input: "{{query}}"
            - agent: junyi_topic_agent
              input: "{{query}}"
      ```
    - ä»£è¡¨é è¨­æœƒä¾åºå‘¼å« agent_a â†’ agent_b â†’ junyi_tree_agent â†’ junyi_topic_agentï¼Œæ¯å€‹ agent éƒ½æœƒæ”¶åˆ° query ä½œç‚ºè¼¸å…¥ã€‚
    - è‹¥æœ‰å¤šç¨® routeï¼Œå¯ä¾éœ€æ±‚æ–°å¢ä¸åŒåç¨±çš„ routesã€‚
    - routes è¨­å®šå¯è®“éå·¥ç¨‹å¸«ç”¨ YAML å¿«é€Ÿèª¿æ•´å¤š agent pipelineã€‚

- **Python è¨»å†Š**ï¼ˆfor å·¥ç¨‹å¸«ï¼‰
  - åœ¨ `src/agent_registry.py` æ’°å¯« class/function
  - æ–¼ `get_python_agents()` å›å‚³ agent dict
  - é©åˆæœ‰è¤‡é›œé‚è¼¯ã€ç‹€æ…‹ã€å¤–éƒ¨ä¾è³´çš„ agent
  - ç¯„ä¾‹ï¼š
    ```python
    class JunyiTreeAgent(BaseAgent):
        # ...ç•¥...

    def get_python_agents():
        return [
            {
                "id": JunyiTreeAgent.id,
                "name": JunyiTreeAgent.name,
                "description": JunyiTreeAgent.description,
                "example_queries": JunyiTreeAgent.example_queries,
                "respond": JunyiTreeAgent().respond
            },
            # ...å…¶ä»– agent...
        ]
    ```

### è‡ªå‹•åˆä½µé‚è¼¯

1. å•Ÿå‹•æ™‚è‡ªå‹•è¼‰å…¥ YAML èˆ‡ Python å…©é‚Šçš„ agent
2. **YAML ç‚ºä¸»**ï¼šåŒ id ä»¥ YAML è¨­å®šç‚ºä¸»
3. **Python è£œå……**ï¼šYAML æ²’æœ‰çš„ agentï¼Œè‡ªå‹•è£œä¸Š Python ç«¯çš„ agent
4. ç”¢ç”Ÿçµ±ä¸€çš„ `AGENT_LIST`ï¼Œä¾›å‰ç«¯ã€æ¸¬è©¦ã€ä¸»ç¨‹å¼ä½¿ç”¨

---

## API Response Schema

- æ‰€æœ‰ API å›å‚³çš†ç¬¦åˆçµ±ä¸€ schemaï¼ŒåŒ…å«ï¼š
  - `type`
  - `content`
  - `meta`
  - `agent_id`
  - `error`

---

## è¨­è¨ˆåŸå‰‡

- **é«˜æ“´å……æ€§**ï¼šæ–°å¢ agent åƒ…éœ€ç¹¼æ‰¿ BaseAgent ä¸¦è¨»å†Š
- **ä½è€¦åˆ**ï¼šæ„åœ–åˆ¤æ–·ã€agent mappingã€è³‡æ–™æŸ¥è©¢åˆ†å±¤æ˜ç¢º
- **æ¨™æº–åŒ–æ ¼å¼**ï¼šå‰å¾Œç«¯çš†ä»¥çµ±ä¸€ schema æºé€š
- **éŒ¯èª¤è™•ç†å®Œå–„**ï¼šæ‰€æœ‰éŒ¯èª¤çš†æœ‰ fallback èˆ‡æ¨™æº–æ ¼å¼

---

## ç¶­è­·å»ºè­°èˆ‡ FAQ

- ä»€éº¼æ™‚å€™è©²å¯«é€² YAMLï¼Ÿ
  - éœ€è¦**éå·¥ç¨‹å¸«ç¶­è­·**ã€**é‚è¼¯ç°¡å–®**ã€**å›å‚³æ ¼å¼å›ºå®š**æ™‚
- ä»€éº¼æ™‚å€™è©²å¯«åœ¨ Pythonï¼Ÿ
  - éœ€è¦ class ç‹€æ…‹ã€å¤–éƒ¨ä¾è³´ã€é€²éšé‚è¼¯ï¼Œæˆ–ä¸å¸Œæœ›éå·¥ç¨‹å¸«ç¶­è­·æ™‚
- **å»ºè­°æµç¨‹**ï¼šå¤§éƒ¨åˆ† agent å…ˆå¯«åœ¨ Pythonï¼Œç­‰æœ‰éœ€æ±‚æ™‚å†æ¬é€² YAML
- **YAML èˆ‡ Python å¯å…±å­˜**ï¼Œloader æœƒè‡ªå‹•åˆä½µï¼Œç¶­è­·å½ˆæ€§æœ€å¤§

---

## FAQï¼ˆåˆ†å±¤èªªæ˜ï¼‰

- **Tool æ˜¯ä»€éº¼ï¼Ÿ**
  - æœ€åº•å±¤åŠŸèƒ½å–®å…ƒï¼Œç„¡ç‹€æ…‹ã€ç„¡æ±ºç­–ï¼Œåƒ…è² è²¬ã€Œåšäº‹ã€ã€‚
- **Agent æ˜¯ä»€éº¼ï¼Ÿ**
  - æœ‰é‚è¼¯ã€æœ‰ç‹€æ…‹çš„æ™ºèƒ½ä»£ç†ï¼Œæœƒèª¿ç”¨ä¸€å€‹æˆ–å¤šå€‹ toolï¼Œä¸¦å¯å°è©±ã€æ¨ç†ã€‚
- **Orchestrator æ˜¯ä»€éº¼ï¼Ÿ**
  - è² è²¬æ ¹æ“šç”¨æˆ¶éœ€æ±‚ã€ä¸Šä¸‹æ–‡ï¼Œèª¿åº¦ agentï¼Œç®¡ç†å¤šæ­¥æ¨ç†ã€‚

---

## ç›¸é—œæª”æ¡ˆèªªæ˜

- `mcp_config.yaml`ï¼šagent metadata è¨­å®š
- `src/agent_registry.py`ï¼šè‡ªå‹•åˆä½µ YAML èˆ‡ Python agentï¼Œç”¢ç”Ÿ AGENT_LIST

---

## é€²åº¦è¿½è¹¤

### âœ… å·²å®Œæˆ
- DDD æ¶æ§‹åˆ†å±¤ã€å‘½åæ¨™æº–åŒ–ã€åˆ†å±¤å¯æ“´å……
- agent è¨»å†Šé›™è»Œï¼ˆYAML/Pythonï¼‰ã€è‡ªå‹•åˆä½µ
- API è·¯å¾‘èªæ„åŒ–ï¼Œå‰å¾Œç«¯ schema çµ±ä¸€
- å‰ç«¯å®Œæ•´ historyã€æ„åœ–åˆ¤æ–·ã€history answerã€åˆ†æµé‚è¼¯
- å¤š agent èª¿åº¦ã€å–®æ­¥/å¤šæ­¥æ¨ç†ã€history answer
- æ¸¬è©¦è¦†è“‹ agent è¨»å†Šã€åˆä½µã€respond æ ¼å¼èˆ‡ API schema
- UX å„ªåŒ–ï¼šæ„åœ– labelã€<details> æ‘˜è¦ã€éŒ¯èª¤è¨Šæ¯ã€history å±•é–‹
- README æ–‡ä»¶åŒæ­¥åˆ†å±¤ã€æµç¨‹ã€APIã€history spec

### ğŸš§ TODO
- å¢åŠ æ›´å¤š agentï¼ˆGoogle Drive, YouTube, Notion, è‡ªæœ‰ç¶²ç«™ç­‰ï¼‰
- æ”¯æ´å¤šç¨®è³‡æ–™å‹æ…‹
- API server å®Œå–„åŒ–èˆ‡å®‰å…¨æ€§
- è¨­è¨ˆæ›´å½ˆæ€§çš„å‰å¾Œç«¯è³‡æ–™ schema
- plug-in LLM èª¿åº¦ç­–ç•¥ï¼ˆå¦‚ OpenAI/Claude function callingï¼‰
- plug-in å¤šè¼ªæ¨ç†ï¼ˆmulti-turn reasoningï¼‰èˆ‡ä¸Šä¸‹æ–‡ç®¡ç†
- plug-in log/debug æ©Ÿåˆ¶ï¼ˆlog decorator, log view, log levelï¼‰
- plug-in context/session ç®¡ç†ï¼ˆå¤šç”¨æˆ¶ã€å¤š sessionã€ç‹€æ…‹è¿½è¹¤ï¼‰
- API schema è‡ªå‹•ç”¢ç”Ÿï¼ˆOpenAPI/Swaggerï¼‰
- å¤šèªç³» metadata æ”¯æ´
- Agent Health Check/ç†±éƒ¨ç½²/è‡ªå‹• reload
- Agent åˆ†é¡/æœå°‹/tag æ©Ÿåˆ¶

### ğŸ› ï¸ æ¶æ§‹é‡æ§‹å»ºè­°ï¼ˆRefactor Checklistï¼‰
- [x] æŠ½è±¡å‡º BaseAgent/Tool interfaceï¼Œæ‰€æœ‰ agent å¯¦ä½œ respond() ä¸¦çµ±ä¸€å›å‚³æ ¼å¼
- [x] å»ºç«‹ AgentRegistry/Manager classï¼Œçµ±ä¸€ç®¡ç† agent è¨»å†Šã€æŸ¥è©¢ã€åˆä½µï¼ˆYAML/Pythonï¼‰
- [x] æ”¯æ´è‡ªå‹•æƒæ agents/ ç›®éŒ„ï¼Œè‡ªå‹•è¨»å†Šæ‰€æœ‰ agent
- [x] function èˆ‡ metadata åˆ†é›¢ï¼Œmetadata å¯ç”± YAML/JSON ç”¢ç”Ÿï¼Œfunction ç”± Python ç¶å®š
- [x] Orchestrator å®Œå…¨å‡½å¼åŒ–èˆ‡æ¨¡çµ„åŒ–ï¼Œæ”¯æ´å¤šç¨®èª¿åº¦ç­–ç•¥ï¼ˆif-elseã€LLMã€rule-basedï¼‰
- [x] èª¿åº¦ç­–ç•¥åˆ†é›¢ï¼šå–®æ­¥ã€å¤šæ­¥ã€æ„åœ–åˆ¤æ–·ã€fallback å¯ç¨ç«‹æˆ method
- [x] çµ±ä¸€æ‰€æœ‰ agent çš„ response schemaï¼ŒåŠ å¼·éŒ¯èª¤è™•ç†
- [x] å¢åŠ  orchestratorã€APIã€agent respond çš„å–®å…ƒæ¸¬è©¦
- [x] å‰å¾Œç«¯ schema æ¨™æº–åŒ–ï¼Œæ‰€æœ‰å›å‚³çš†ç”¨çµ±ä¸€æ ¼å¼ï¼Œæ–¹ä¾¿å‰ç«¯é¡¯ç¤ºèˆ‡ debug
- [x] plug-in LLM èª¿åº¦ã€å¤šè¼ªæ¨ç†å·²æ¨¡çµ„åŒ–ï¼ˆorchestrator_utils/ï¼‰
- [ ] plug-in context/session ç®¡ç†ï¼ˆå¤šç”¨æˆ¶ã€å¤š sessionã€ç‹€æ…‹è¿½è¹¤ç­‰ï¼Œé ç•™æ“´å……ç©ºé–“ï¼‰
- [x] plug-in log/debug æ©Ÿåˆ¶ï¼ˆlog_call decoratorï¼‰åˆæ­¥å®Œæˆ

---

## æ¸¬è©¦èªªæ˜

### 1. å®‰è£æ¸¬è©¦å¥—ä»¶

```bash
pip install pytest
```

### 2. åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦

```bash
pytest
```

### 3. åŸ·è¡Œç‰¹å®šæ¸¬è©¦æª”æ¡ˆ

```bash
pytest tests/test_agent_registry.py
```

### 4. é¡¯ç¤ºè©³ç´°æ¸¬è©¦éç¨‹

```bash
pytest -v
```

### 5. ç”¢ç”Ÿæ¸¬è©¦è¦†è“‹ç‡å ±å‘Šï¼ˆå¯é¸ï¼‰

```bash
pip install pytest-cov
pytest --cov=src
```

## åŸ·è¡Œæ¸¬è©¦

ä¸€èˆ¬æ¸¬è©¦ï¼š
```bash
make test
```

é¡¯ç¤º coverageï¼ˆæ¸¬è©¦è¦†è“‹ç‡ï¼‰ï¼š
```bash
PYTHONPATH=. pytest --cov=src tests/
```

---

**èªªæ˜ï¼š**
- æ‰€æœ‰æ¸¬è©¦ç¨‹å¼æ”¾åœ¨ `tests/` ç›®éŒ„ä¸‹ã€‚
- ä¸»è¦æ¸¬è©¦ agent è¨»å†Šã€åˆä½µã€respond æ ¼å¼èˆ‡ API schemaã€‚
- è‹¥æœ‰æ–°å¢ agent æˆ–èª¿æ•´æ¶æ§‹ï¼Œè«‹å‹™å¿…åŸ·è¡Œæ¸¬è©¦ç¢ºä¿æ­£ç¢ºæ€§ã€‚

---

## Changelog

### 2025/5/7
- orchestrator.py å®Œå…¨å‡½å¼åŒ–èˆ‡æ¨¡çµ„åŒ–ï¼Œç§»é™¤ Orchestrator class
- å¤šè¼ªæ¨ç†èˆ‡åˆ†æ­¥æ¨ç†çµ±ä¸€ï¼Œçš†å…·å‚™é˜²é‡è¤‡æŸ¥è©¢èƒ½åŠ›
- prompt çµ„è£ã€LLM å‘¼å«ã€å·¥å…·æ¸…å–®ã€æ ¼å¼é©—è­‰ç­‰æŠ½å‡ºç‚ºç¨ç«‹æ¨¡çµ„ï¼ˆsrc/orchestrator_utils/ï¼‰
- ç§»é™¤å†—é¤˜ function èˆ‡ importï¼Œæ¸¬è©¦èˆ‡ä¸»æµç¨‹åˆ†é›¢
- plug-in log/debug æ©Ÿåˆ¶ï¼ˆlog_call decoratorï¼‰åˆæ­¥å®Œæˆ
- README checklistã€æª”æ¡ˆèªªæ˜ã€FAQ åŒæ­¥æ›´æ–°

### 2025/5/8
- å®Œæˆ DDD åˆ†å±¤é‡æ§‹ï¼ˆtools/agents/orchestratorï¼‰ï¼Œåˆ†å±¤æ˜ç¢ºã€å‘½åæ¨™æº–åŒ–
- API è·¯å¾‘èªæ„åŒ–ï¼Œ/orchestrate â†’ /agent/single_turn_dispatchï¼Œ/multi_turn_step â†’ /agent/multi_turn_step
- agent è¨»å†Šé›™è»Œï¼ˆYAML+Pythonï¼‰ï¼Œè‡ªå‹•åˆä½µï¼Œåˆ†å±¤å¯æ“´å……
- orchestrator åªèª¿åº¦ agentï¼Œagent å°è£ toolï¼Œåˆ†å±¤ä¾è³´æ­£ç¢º
- å‰ç«¯å®Œæ•´ç¶­è­· historyï¼Œæ”¯æ´å¤šè¼ªå°è©±ã€history answerã€æ„åœ–åˆ¤æ–·
- å‰ç«¯/å¾Œç«¯è³‡æ–™æµã€API schemaã€åˆ†æµé‚è¼¯ã€history spec å…¨é¢åŒæ­¥
- UX å„ªåŒ–ï¼šæ„åœ– labelã€<details> æ‘˜è¦ã€éŒ¯èª¤è¨Šæ¯ã€history å±•é–‹
- README æ¶æ§‹åœ–ã€history/intention/spec æµç¨‹ã€åˆ†å±¤èªªæ˜åŒæ­¥æ›´æ–°
- æ¸¬è©¦è¦†è“‹ agent è¨»å†Šã€åˆä½µã€respond æ ¼å¼èˆ‡ API schema