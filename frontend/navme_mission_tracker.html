<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>Navme ä»»å‹™è¿½è¹¤</title>
  <link rel="stylesheet" href="navme_style.css">
  <style>
    .dashboard-container { display: flex; max-width: 1200px; margin: 32px auto; min-height: 80vh; background: #fff; border-radius: 18px; box-shadow: 0 2px 16px #0001; }
    .dashboard-calendar {
      min-width: 320px;
      max-width: 420px;
      width: 100%;
      flex: 1;
      border-right: 1.5px solid #e3eaf3;
      padding: 32px 18px 32px 32px;
    }
    .dashboard-tracker { flex: 2; padding: 32px 32px 32px 24px; min-width: 0; }
    @media (max-width: 900px) {
      .dashboard-container { flex-direction: column; }
      .dashboard-calendar, .dashboard-tracker { max-width: 100%; border-right: none; padding: 18px; }
    }
    /* è¡Œäº‹æ›†æ’ç‰ˆä¿®æ­£ */
    .dashboard-calendar .calendar-grid {
      width: 100%;
      box-sizing: border-box;
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      overflow-x: auto;
    }
    .dashboard-calendar .calendar-cell,
    .dashboard-calendar .calendar-day {
      min-width: 0;
      max-width: unset;
      min-height: 36px;
      font-size: 1.08em;
      padding: 0;
      margin: 0 auto;
      justify-content: center;
      align-items: center;
      display: flex;
      flex-direction: row;
      gap: 4px;
    }
    .dashboard-calendar .calendar-date-num {
      font-weight: bold;
    }
    .calendar-header {
      font-size: 1.1em;
      margin-bottom: 8px;
    }
    .dashboard-calendar .calendar-cell {
      transition: background 0.18s, border 0.18s, box-shadow 0.18s, color 0.18s;
      cursor: pointer;
      border: 2px solid transparent;
      border-radius: 10px;
      background: #fff;
      box-shadow: none;
      position: relative;
      z-index: 0;
    }
    .dashboard-calendar .calendar-cell:hover {
      background: #e3f2fd;
      border: 2px solid #64b5f6;
      box-shadow: 0 2px 8px #90caf950;
      color: #1976d2;
      z-index: 2;
    }
    .dashboard-calendar .calendar-cell.selected {
      background: linear-gradient(90deg, #bbdefb 60%, #e3f2fd 100%);
      border: 2.5px solid #1976d2;
      color: #1976d2;
      box-shadow: 0 4px 16px #1976d230;
      z-index: 3;
    }
    .dashboard-calendar .calendar-cell.today:not(.selected) {
      border: 2px solid #42a5f5;
      background: #e3f2fd;
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <div class="dashboard-calendar">
      <div id="mission-calendar"></div>
    </div>
    <div class="dashboard-tracker">
      <div id="mission-tracker"></div>
    </div>
  </div>
  <script src="navme_mission_tracker.js"></script>
  <script src="navme_calendar.js"></script>
  <script>
    // åµŒå…¥ calendarï¼Œé»æ“Šæ—¥æœŸæ™‚å³å´è¼‰å…¥è©²æ—¥ tracker
    // é è¨­è¼‰å…¥ä»Šæ—¥
    let selectedDate = new Date().toISOString().slice(0, 10);
    let currentMonth = new Date(selectedDate);
    currentMonth.setDate(1);
    const calendarEl = document.getElementById('mission-calendar');
    function getMonthData(year, month) {
      const days = [];
      const lastDay = new Date(year, month + 1, 0);
      for (let d = 1; d <= lastDay.getDate(); d++) {
        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
        const data = JSON.parse(localStorage.getItem('navme_calendar_' + dateStr) || '{}');
        days.push({ date: dateStr, ...data });
      }
      return days;
    }
    function renderMissionCalendar() {
      calendarEl.innerHTML = '';
      // header
      const header = document.createElement('div');
      header.className = 'calendar-header';
      const prevBtn = document.createElement('button'); prevBtn.textContent = 'â—€';
      const nextBtn = document.createElement('button'); nextBtn.textContent = 'â–¶';
      const monthLabel = document.createElement('span');
      monthLabel.id = 'calendarMonth';
      monthLabel.textContent = `${currentMonth.getFullYear()} å¹´ ${currentMonth.getMonth() + 1} æœˆ`;
      header.appendChild(prevBtn); header.appendChild(monthLabel); header.appendChild(nextBtn);
      calendarEl.appendChild(header);
      // days row
      const daysRow = document.createElement('div'); daysRow.className = 'calendar-grid';
      for (let d of ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­']) {
        const el = document.createElement('div'); el.className = 'calendar-day'; el.textContent = d; daysRow.appendChild(el);
      }
      calendarEl.appendChild(daysRow);
      // grid
      const grid = document.createElement('div'); grid.className = 'calendar-grid';
      const year = currentMonth.getFullYear();
      const month = currentMonth.getMonth();
      const firstDayOfWeek = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      // è£œç©ºæ ¼
      for (let i = 0; i < firstDayOfWeek; i++) {
        const empty = document.createElement('div'); empty.className = 'calendar-cell'; grid.appendChild(empty);
      }
      // æ—¥æœŸ
      const todayStr = (new Date()).toISOString().slice(0, 10);
      const monthData = getMonthData(year, month);
      for (let i = 0; i < daysInMonth; i++) {
        const d = i + 1;
        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
        const cell = document.createElement('div');
        cell.className = 'calendar-cell';
        // ä¸å†ç”¨ style è¨­å®š flexï¼Œå…¨éƒ¨äº¤çµ¦ class
        if (dateStr === todayStr) cell.classList.add('today');
        if (dateStr === selectedDate) cell.classList.add('selected');
        // é€²åº¦ emoji
        const data = monthData[i];
        let emoji = 'â¬œï¸';
        if (data && typeof data.progress === 'number') {
          if (data.progress >= 1) emoji = 'âœ…';
          else if (data.progress >= 0.7) emoji = 'ğŸŸ¢';
          else if (data.progress > 0) emoji = 'ğŸŸ¡';
          else emoji = 'â¬œï¸';
        }
        const numSpan = document.createElement('span');
        numSpan.className = 'calendar-date-num';
        numSpan.textContent = d;
        const emojiSpan = document.createElement('span');
        emojiSpan.className = 'progress-emoji';
        emojiSpan.textContent = emoji;
        cell.appendChild(numSpan);
        cell.appendChild(emojiSpan);
        cell.onclick = () => {
          selectedDate = dateStr;
          renderMissionCalendar();
          // å³å´è¼‰å…¥è©²æ—¥ tracker
          if(window.renderMissionTracker) window.renderMissionTracker(selectedDate);
        };
        grid.appendChild(cell);
      }
      calendarEl.appendChild(grid);
      // æœˆä»½åˆ‡æ›
      prevBtn.onclick = () => { currentMonth.setMonth(currentMonth.getMonth() - 1); renderMissionCalendar(); };
      nextBtn.onclick = () => { currentMonth.setMonth(currentMonth.getMonth() + 1); renderMissionCalendar(); };
    }
    // å³å´ tracker è¼‰å…¥å‡½å¼ï¼ˆè¦†è“‹åŸæœ¬çš„ï¼‰
    window.renderMissionTracker = function(dateStr) {
      const container = document.getElementById('mission-tracker');
      container.innerHTML = '';
      let data = JSON.parse(localStorage.getItem('navme_calendar_' + dateStr) || '{}');
      if (!data || !data.tasks) {
        data = {
          date: dateStr,
          progress: 0,
          mood: '',
          note: '',
          tasks: [
            { title: 'ä»»å‹™1', status: 'not_started', note: '' },
            { title: 'ä»»å‹™2', status: 'not_started', note: '' },
            { title: 'ä»»å‹™3', status: 'not_started', note: '' }
          ]
        };
      }
      const doneCount = data.tasks.filter(t => t.status === 'completed').length;
      const totalCount = data.tasks.length;
      let html = `<h3>ğŸ§­ ${dateStr} ä»»å‹™è¿½è¹¤</h3>`;
      html += `<div style='margin-bottom:12px;'>ğŸ“‹ ä»Šæ—¥ä»»å‹™ï¼ˆå·²å®Œæˆ <span id='done-count'>${doneCount}</span> / <span id='total-count'>${totalCount}</span>ï¼‰</div>`;
      html += `<div id='task-list'>`;
      data.tasks.forEach((task, idx) => {
        html += `<div class='mission-card-list' style='margin-bottom:10px;'>`;
        html += `<div style='display:flex;align-items:center;gap:8px;'>`;
        html += `<input type='checkbox' id='task-done-${idx}' ${task.status==='completed'?'checked':''} style='transform:scale(1.3);' />`;
        html += `<div class='mission-title'>${task.title}</div>`;
        html += `</div>`;
        if(task.status==='completed') {
          html += `<div class='mission-desc'>âœ”ï¸ å·²å®Œæˆ${task.note?`<br>ğŸ“${task.note}`:''}</div>`;
        } else {
          html += `<div class='mission-desc'>${task.note ? 'ğŸ“ ' + task.note : ''}</div>`;
        }
        html += `<textarea class='note-input' id='note-input-${idx}' placeholder='å¯«ä¸‹ä½ çš„è§€å¯Ÿ/å¿ƒå¾—...' style='width:100%;min-height:36px;margin-top:8px;'>${task.note||''}</textarea>`;
        html += `<button class='save-note-btn' data-idx='${idx}' style='margin-top:6px;'>ğŸ’¾ å„²å­˜å‚™è¨»</button>`;
        html += `</div>`;
      });
      html += `</div>`;
      html += `<div style="margin:24px 0 8px 0;">
        <b>ğŸ“ ä»Šæ—¥å¿ƒå¾—ï¼š</b><br>
        <textarea id="today-summary" style="width:100%;min-height:60px;">${data.note||''}</textarea>
      </div>`;
      container.innerHTML = html;
      data.tasks.forEach((task, idx) => {
        container.querySelector(`#task-done-${idx}`).onchange = e => {
          task.status = e.target.checked ? 'completed' : 'not_started';
          saveAndSync();
        };
        const saveBtn = container.querySelector(`.save-note-btn[data-idx='${idx}']`);
        if(saveBtn) saveBtn.onclick = () => {
          const val = container.querySelector(`#note-input-${idx}`).value;
          task.note = val;
          saveAndSync();
        };
      });
      const summaryInput = container.querySelector('#today-summary');
      if(summaryInput) summaryInput.oninput = e => { data.note = e.target.value; saveAndSync(); };
      function saveAndSync() {
        const doneCount = data.tasks.filter(t => t.status === 'completed').length;
        const totalCount = data.tasks.length;
        data.progress = totalCount > 0 ? doneCount / totalCount : 0;
        localStorage.setItem('navme_calendar_' + dateStr, JSON.stringify(data));
        renderMissionCalendar();
        window.renderMissionTracker(dateStr);
      }
    }
    // é è¨­è¼‰å…¥ä»Šæ—¥
    renderMissionCalendar();
    window.renderMissionTracker(selectedDate);
  </script>
</body>
</html> 